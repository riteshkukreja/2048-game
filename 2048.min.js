var TwentyFortyEightGame=function(e){var r=document.createElement("canvas"),t=e?e.holder||document.body:document.body,i=e?e.size||8:8,n=e?e.width||window.innerHeight-100:window.innerHeight-100,o=e?e.height||window.innerHeight-100:window.innerHeight-100;r.width=n,r.height=o;var f=function(e,r){var t=[],i=0,f=!1,a=e.getContext("2d"),c={EMPTY:0,START:2,FINAL:2048},l={0:"#ecf0f1",2:"#1abc9c",4:"#2ecc71",8:"#3498db",16:"#9b59b6",32:"#e67e22",64:"#f39c12",128:"#e74c3c",256:"#2980b9",512:"#8e44ad",1024:"#d35400",2048:"#c0392b",lose:"#c0392b",won:"#2980b9",button:"#e67e22"},u={LEFT:0,RIGHT:1,TOP:2,DOWN:3},h=function(){t=[];for(var e=0;r>e;e++){for(var n=[],o=0;r>o;o++)n.push(c.EMPTY);t.push(n)}t[2][2]=c.START,i=0,f=!1,y()},v=function(){for(var e=[],i=0;r>i;i++)for(var n=0;r>n;n++)t[i][n]==c.EMPTY&&(n-1>=0&&t[i][n-1]!=c.EMPTY||r>n+1&&t[i][n+1]!=c.EMPTY||i-1>=0&&t[i-1][n]!=c.EMPTY||r>i+1&&t[i+1][n]!=c.EMPTY)&&e.push([i,n]);if(0==e.length)return!1;var o=Math.floor(Math.random()*e.length);return e[o]},T=function(){for(var e=0;r>e;e++)for(var i=0;r>i;i++)if(t[e][i]==c.FINAL)return!0;return!1},s=function(e,t){for(var i=0;r>i;i++)for(var n=0;r>n;n++)if(e[i][n]!=t[i][n])return!1;return!0},d=function(){for(var e=[],i=0;r>i;i++){for(var n=[],o=0;r>o;o++)n.push(t[i][o]);e.push(n)}for(var f in u)if(e=w(e,u[f]),!s(t,e))return!0;return!1},b=function(e,r){var i=t[e[0]][e[1]];t[e[0]][e[1]]=t[r[0]][r[1]],t[r[0]][r[1]]=i},w=function(e,t){switch(t){case u.LEFT:for(var i=0;r>i;i++)for(var n=1;r>n;n++)e[i][n]!=c.EMPTY&&e[i][n-1]==e[i][n]&&(e[i][n-1]+=e[i][n],e[i][n]=c.EMPTY,P(e[i][n-1]));break;case u.RIGHT:for(var i=0;r>i;i++)for(var n=r-1;n>=0;n--)e[i][n]!=c.EMPTY&&e[i][n-1]==e[i][n]&&(e[i][n]+=e[i][n-1],e[i][n-1]=c.EMPTY,P(e[i][n]));break;case u.UP:for(var i=1;r>i;i++)for(var n=0;r>n;n++)e[i][n]!=c.EMPTY&&e[i-1][n]==e[i][n]&&(e[i-1][n]+=e[i][n],e[i][n]=c.EMPTY,P(e[i-1][n]));break;case u.DOWN:for(var i=r-1;i>0;i--)for(var n=0;r>n;n++)e[i][n]!=c.EMPTY&&e[i-1][n]==e[i][n]&&(e[i][n]+=e[i-1][n],e[i-1][n]=c.EMPTY,P(e[i][n]))}return e},E=function(e,t){switch(t){case u.LEFT:for(var i=0;r>i;i++)for(var n=0,o=0;r>n&&r>o;){for(;r>n&&e[i][n]!=c.EMPTY;)n++;if(n==r)break;for(;r>o&&(e[i][o]==c.EMPTY||n>o);)o++;if(o==r)break;b([i,o],[i,n])}break;case u.RIGHT:for(var i=0;r>i;i++)for(var n=r-1,o=r-1;n>=0&&o>=0;){for(;n>=0&&e[i][n]!=c.EMPTY;)n--;if(0>=n)break;for(;o>=0&&(e[i][o]==c.EMPTY||o>n);)o--;if(0>o)break;b([i,o],[i,n])}break;case u.UP:for(var i=0;r>i;i++)for(var n=0,o=0;r>n&&r>o;){for(;r>n&&e[n][i]!=c.EMPTY;)n++;if(n==r)break;for(;r>o&&(e[o][i]==c.EMPTY||n>o);)o++;if(o==r)break;b([o,i],[n,i])}break;case u.DOWN:for(var i=r-1;i>=0;i--)for(var n=r-1,o=r-1;n>=0&&o>=0;){for(;n>=0&&e[n][i]!=c.EMPTY;)n--;if(0>=n)break;for(;o>=0&&(e[o][i]==c.EMPTY||o>n);)o--;if(0>o)break;b([o,i],[n,i])}}return e},P=function(e){i+=e},M=function(e){if(!f){if(t=E(t,e),t=w(t,e),t=E(t,e),T())return y(),void x(!0);var r=v();if(r===!1)return void(d()||(y(),x(!1)));t[r[0]][r[1]]=c.START,y()}},g=function(e,r,t,i,n){a.fillStyle=l[n],a.fillRect(e,r,t,i),n!=c.EMPTY&&(a.fillStyle="#FFF",a.font="25px Georgia",a.textAlign="center",a.textBaseline="middle",a.fillText(n,e+t/2,r+i/2))},Y=function(){a.beginPath(),a.fillStyle="#c0392b",a.font="20px Georgia",a.textAlign="center",a.textBaseline="middle",a.fillText(i,n-50,30)},p=function(){a.clearRect(0,0,e.width,e.height)},x=function(e){var r=n/2,t=o/2;f=!0,a.fillStyle="rgba(0, 0, 0, .5)",a.fillRect(0,0,n,o),a.fillStyle=e?l.won:l.lose,a.fillRect(n/4,o/4,r,t),a.fillStyle="#FFF",a.textAlign="center",e?(a.font="100 20px calibri",a.fillText("Your Score is",n/2,o/4+40),a.font="100 80px calibri",a.fillText(i,n/2,o/4+120)):(a.font="100 40px calibri",a.fillText("You Lose!",n/2,o/4+60));new k(h,n/3,o/4+200,n/3,60,"Play again?")},k=function(r,t,i,n,o,f){var c=function(){a.fillStyle=l.button,a.arc(t+n/2-o,i+o/2,o/2,0,2*Math.PI),a.fill(),a.arc(t+n/2+o,i+o/2,o/2,0,2*Math.PI),a.fill(),a.fillRect(t+o/2,i,n-o,o),a.fillStyle="#FFF",a.textAlign="center",a.textBaseline="middle",a.font="20px calibri",a.fillText(f,t+n/2,i+o/2)},u=function(r){var t=e.getBoundingClientRect(),i=(r.clientX-t.left)/(t.right-t.left)*e.width,n=(r.clientY-t.top)/(t.bottom-t.top)*e.height;return{x:i,y:n}};c(),window.addEventListener("click",function(e){var f=u(e);f.x<=t+n&&f.x>=t&&f.y>=i&&f.y<=i+o&&r()})},y=function(){var i=Math.floor(e.width/r),n=Math.floor(e.height/r);p();for(var o=0;r>o;o++)for(var f=0;r>f;f++)g(f*i,o*n,i,n,t[o][f]);Y()};this.swipeLeft=function(){M(u.LEFT)},this.swipeRight=function(){M(u.RIGHT)},this.swipeUp=function(){M(u.UP)},this.swipeDown=function(){M(u.DOWN)},h()},a=new f(r,i);t.appendChild(r),window.addEventListener("keydown",function(e){var r=e.keyCode||e.charCode;switch(r){case 38:a.swipeUp();break;case 37:a.swipeLeft();break;case 40:a.swipeDown();break;case 39:a.swipeRight()}})};TwentyFortyEightGame();